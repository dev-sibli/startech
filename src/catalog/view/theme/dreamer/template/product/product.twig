{{ header }}
<div id="product-product" class="container">
  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
    <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
    {% endfor %}
  </ul>

  <div class="row">{{ column_left }}
    {% if column_left and column_right %}
    {% set class = 'col-sm-6' %}
    {% elseif column_left or column_right %}
    {% set class = 'col-sm-9' %}
    {% else %}
    {% set class = 'col-sm-12' %}
    {% endif %}
    <div id="content" class="{{ class }}">{{ content_top }}

      {# Two-column product grid: images left, info right #}
      <div class="product-detail-grid">

        {# ── Left: image gallery ── #}
        <div class="product-images-col">
          {% if thumb or images %}
          <ul class="product-thumbnails" id="product-thumbnails">
            {% if thumb %}
            <li class="product-thumb-main">
              <a class="product-thumb-link" href="{{ popup }}" title="{{ heading_title }}">
                <img src="{{ thumb }}" title="{{ heading_title }}" alt="{{ heading_title }}" />
              </a>
            </li>
            {% endif %}
            {% for image in images %}
            <li class="product-thumb-additional">
              <a class="product-thumb-link" href="{{ image.popup }}" title="{{ heading_title }}">
                <img src="{{ image.thumb }}" title="{{ heading_title }}" alt="{{ heading_title }}" />
              </a>
            </li>
            {% endfor %}
          </ul>
          {% endif %}
        </div>

        {# ── Right: product info ── #}
        <div class="product-info-col">
          <div class="product-actions-top">
            <button type="button" class="btn-icon" title="{{ button_wishlist }}" onclick="wishlist.add('{{ product_id }}');">
              <i class="material-icons">favorite_border</i>
            </button>
            <button type="button" class="btn-icon" title="{{ button_compare }}" onclick="compare.add('{{ product_id }}');">
              <i class="material-icons">compare_arrows</i>
            </button>
          </div>
          <h1 class="product-title">{{ heading_title }}</h1>
          <ul class="product-meta list-unstyled">
            {% if manufacturer %}
            <li>{{ text_manufacturer }} <a href="{{ manufacturers }}">{{ manufacturer }}</a></li>
            {% endif %}
            <li>{{ text_model }} {{ model }}</li>
            {% if reward %}
            <li>{{ text_reward }} {{ reward }}</li>
            {% endif %}
            <li>{{ text_stock }} {{ stock }}</li>
          </ul>

          {% if price %}
          <div class="product-price-block">
            {% if not special %}
            <span class="product-price">{{ price }}</span>
            {% else %}
            <span class="product-price">{{ special }}</span>
            <span class="product-price-old">{{ price }}</span>
            {% endif %}
            {% if tax %}<div class="product-tax">{{ text_tax }} {{ tax }}</div>{% endif %}
            {% if points %}<div class="product-points">{{ text_points }} {{ points }}</div>{% endif %}
            {% if discounts %}
            <ul class="product-discounts list-unstyled">
              {% for discount in discounts %}
              <li>{{ discount.quantity }}{{ text_discount }}{{ discount.price }}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>
          {% endif %}

          {% if review_status %}
          <div class="product-rating">
            {% for i in 1..5 %}
            <i class="material-icons">{% if rating >= i %}star{% else %}star_border{% endif %}</i>
            {% endfor %}
            <a href="#tab-review" class="review-link">{{ reviews }}</a>
            / <a href="#tab-review" class="review-link">{{ text_write }}</a>
          </div>
          {% endif %}

          <div id="product">
            {% if options %}
            <hr>
            <h3>{{ text_option }}</h3>
            {% for option in options %}

            {% if option.type == 'select' %}
            <div class="form-group{% if option.required %} required{% endif %}">
              <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
              <select name="option[{{ option.product_option_id }}]" id="input-option{{ option.product_option_id }}" class="form-control">
                <option value="">{{ text_select }}</option>
                {% for v in option.product_option_value %}
                <option value="{{ v.product_option_value_id }}">{{ v.name }}{% if v.price %} ({{ v.price_prefix }}{{ v.price }}){% endif %}</option>
                {% endfor %}
              </select>
            </div>
            {% endif %}

            {% if option.type == 'radio' %}
            <div class="form-group{% if option.required %} required{% endif %}">
              <label class="control-label">{{ option.name }}</label>
              <div id="input-option{{ option.product_option_id }}">
                {% for v in option.product_option_value %}
                <div class="radio">
                  <label>
                    <input type="radio" name="option[{{ option.product_option_id }}]" value="{{ v.product_option_value_id }}" />
                    {% if v.image %}<img src="{{ v.image }}" alt="{{ v.name }}" class="img-thumbnail" />{% endif %}
                    {{ v.name }}{% if v.price %} ({{ v.price_prefix }}{{ v.price }}){% endif %}
                  </label>
                </div>
                {% endfor %}
              </div>
            </div>
            {% endif %}

            {% if option.type == 'checkbox' %}
            <div class="form-group{% if option.required %} required{% endif %}">
              <label class="control-label">{{ option.name }}</label>
              <div id="input-option{{ option.product_option_id }}">
                {% for v in option.product_option_value %}
                <div class="checkbox">
                  <label>
                    <input type="checkbox" name="option[{{ option.product_option_id }}][]" value="{{ v.product_option_value_id }}" />
                    {% if v.image %}<img src="{{ v.image }}" alt="{{ v.name }}" class="img-thumbnail" />{% endif %}
                    {{ v.name }}{% if v.price %} ({{ v.price_prefix }}{{ v.price }}){% endif %}
                  </label>
                </div>
                {% endfor %}
              </div>
            </div>
            {% endif %}

            {% if option.type == 'text' %}
            <div class="form-group{% if option.required %} required{% endif %}">
              <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
              <input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" placeholder="{{ option.name }}" id="input-option{{ option.product_option_id }}" class="form-control" />
            </div>
            {% endif %}

            {% if option.type == 'textarea' %}
            <div class="form-group{% if option.required %} required{% endif %}">
              <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
              <textarea name="option[{{ option.product_option_id }}]" rows="5" placeholder="{{ option.name }}" id="input-option{{ option.product_option_id }}" class="form-control">{{ option.value }}</textarea>
            </div>
            {% endif %}

            {% if option.type == 'file' %}
            <div class="form-group{% if option.required %} required{% endif %}">
              <label class="control-label">{{ option.name }}</label>
              <button type="button" id="button-upload{{ option.product_option_id }}" class="btn btn-default btn-block">
                <i class="material-icons">upload</i> {{ button_upload }}
              </button>
              <input type="hidden" name="option[{{ option.product_option_id }}]" value="" id="input-option{{ option.product_option_id }}" />
            </div>
            {% endif %}

            {# Date / time options — native HTML5 inputs, no jQuery plugin needed #}
            {% if option.type == 'date' %}
            <div class="form-group{% if option.required %} required{% endif %}">
              <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
              <input type="date" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" id="input-option{{ option.product_option_id }}" class="form-control" />
            </div>
            {% endif %}

            {% if option.type == 'datetime' %}
            <div class="form-group{% if option.required %} required{% endif %}">
              <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
              <input type="datetime-local" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" id="input-option{{ option.product_option_id }}" class="form-control" />
            </div>
            {% endif %}

            {% if option.type == 'time' %}
            <div class="form-group{% if option.required %} required{% endif %}">
              <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
              <input type="time" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" id="input-option{{ option.product_option_id }}" class="form-control" />
            </div>
            {% endif %}

            {% endfor %}
            {% endif %}

            {% if recurrings %}
            <hr>
            <h3>{{ text_payment_recurring }}</h3>
            <div class="form-group required">
              <select name="recurring_id" class="form-control">
                <option value="">{{ text_select }}</option>
                {% for recurring in recurrings %}
                <option value="{{ recurring.recurring_id }}">{{ recurring.name }}</option>
                {% endfor %}
              </select>
              <div class="help-block" id="recurring-description"></div>
            </div>
            {% endif %}

            <div class="form-group">
              <label class="control-label" for="input-quantity">{{ entry_qty }}</label>
              <input type="number" name="quantity" value="{{ minimum }}" min="1" id="input-quantity" class="form-control" />
              <input type="hidden" name="product_id" value="{{ product_id }}" />
              <br />
              <button type="button" id="button-cart" class="btn btn-primary btn-lg btn-block">{{ button_cart }}</button>
            </div>

            {% if minimum > 1 %}
            <div class="alert alert-info">
              <i class="material-icons">info</i> {{ text_minimum }}
            </div>
            {% endif %}
          </div>
        </div>

      </div>{# /.product-detail-grid #}

      {# ── Tabs: description, specs, reviews — full width below grid ── #}
      <div class="product-tabs">
        <ul class="product-tab-nav" role="tablist">
          <li class="product-tab-item active">
            <a href="#tab-description" class="product-tab-link" role="tab">{{ tab_description }}</a>
          </li>
          {% if attribute_groups %}
          <li class="product-tab-item">
            <a href="#tab-specification" class="product-tab-link" role="tab">{{ tab_attribute }}</a>
          </li>
          {% endif %}
          {% if review_status %}
          <li class="product-tab-item">
            <a href="#tab-review" class="product-tab-link" role="tab">{{ tab_review }}</a>
          </li>
          {% endif %}
        </ul>
        <div class="product-tab-content">
          <div class="product-tab-pane active" id="tab-description">{{ description }}</div>
          {% if attribute_groups %}
          <div class="product-tab-pane" id="tab-specification">
            <table class="spec-table">
              {% for attribute_group in attribute_groups %}
              <thead>
                <tr><td colspan="2"><strong>{{ attribute_group.name }}</strong></td></tr>
              </thead>
              <tbody>
              {% for attribute in attribute_group.attribute %}
              <tr>
                <td>{{ attribute.name }}</td>
                <td>{{ attribute.text }}</td>
              </tr>
              {% endfor %}
              </tbody>
              {% endfor %}
            </table>
          </div>
          {% endif %}
          {% if review_status %}
          <div class="product-tab-pane" id="tab-review">
            <form id="form-review">
              <div id="review"></div>
              <h2>{{ text_write }}</h2>
              {% if review_guest %}
              <div class="form-group required">
                <label class="control-label" for="input-name">{{ entry_name }}</label>
                <input type="text" name="name" value="{{ customer_name }}" id="input-name" class="form-control" />
              </div>
              <div class="form-group required">
                <label class="control-label" for="input-review">{{ entry_review }}</label>
                <textarea name="text" rows="5" id="input-review" class="form-control"></textarea>
                <div class="help-block">{{ text_note }}</div>
              </div>
              <div class="form-group required">
                <label class="control-label">{{ entry_rating }}</label>
                <div class="rating-input">
                  {{ entry_bad }}&nbsp;
                  <input type="radio" name="rating" value="1" />
                  <input type="radio" name="rating" value="2" />
                  <input type="radio" name="rating" value="3" />
                  <input type="radio" name="rating" value="4" />
                  <input type="radio" name="rating" value="5" />
                  {{ entry_good }}
                </div>
              </div>
              {{ captcha }}
              <div class="buttons">
                <button type="button" id="button-review" class="btn btn-primary">{{ button_continue }}</button>
              </div>
              {% else %}
              {{ text_login }}
              {% endif %}
            </form>
          </div>
          {% endif %}
        </div>
      </div>

      {% if products %}
      <h3>{{ text_related }}</h3>
      <div class="related-products-grid">
        {% for product in products %}
        <div class="product-layout">
          <div class="product-thumb">
            <div class="image"><a href="{{ product.href }}"><img src="{{ product.thumb }}" alt="{{ product.name }}" title="{{ product.name }}" /></a></div>
            <div class="caption">
              <h4><a href="{{ product.href }}">{{ product.name }}</a></h4>
              <p>{{ product.description }}</p>
              {% if product.price %}
              <div class="price">
                {% if not product.special %}{{ product.price }}
                {% else %}<span class="price-new">{{ product.special }}</span> <span class="price-old">{{ product.price }}</span>{% endif %}
                {% if product.tax %}<span class="price-tax">{{ text_tax }} {{ product.tax }}</span>{% endif %}
              </div>
              {% endif %}
            </div>
            <div class="button-group">
              <button type="button" class="btn-cart" onclick="cart.add('{{ product.product_id }}', '{{ product.minimum }}');">
                <i class="material-icons">shopping_cart</i> {{ button_cart }}
              </button>
              <button type="button" class="btn-compare" title="{{ button_wishlist }}" onclick="wishlist.add('{{ product.product_id }}');">
                <i class="material-icons">favorite_border</i>
              </button>
              <button type="button" class="btn-compare" title="{{ button_compare }}" onclick="compare.add('{{ product.product_id }}');">
                <i class="material-icons">compare_arrows</i>
              </button>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      {% if tags %}
      <p>{{ text_tags }}
        {% for i in 0..tags|length - 1 %}
        <a href="{{ tags[i].href }}">{{ tags[i].tag }}</a>{% if i < (tags|length - 1) %}, {% endif %}
        {% endfor %}
      </p>
      {% endif %}

      {{ content_bottom }}
    </div>
    {{ column_right }}
  </div>
</div>

{# Pass product_id and review_status to product.js via data attributes #}
<div id="product-data"
     data-product-id="{{ product_id }}"
     data-review-status="{{ review_status ? '1' : '0' }}"
     style="display:none;"></div>

{{ footer }}
