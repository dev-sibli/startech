{{ header }}
<div id="product-product" class="container">
  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
    <li><a href="{{ breadcrumb.href }}">{% if loop.first %}<i class="material-icons">home</i>{% else %}{{ breadcrumb.text }}{% endif %}</a></li>
    {% endfor %}
  </ul>

  {# ── Share & Actions Bar ── #}
  <div class="product-share-bar">
    <div class="product-share-left">
      <span class="product-share-label">Share:</span>
      <a href="https://www.facebook.com/dialog/send?link={{ share }}&app_id=140586622674265&redirect_uri={{ share }}" target="_blank" rel="noopener" class="product-share-icon" title="Messenger">
        <i class="material-icons">chat</i>
      </a>
      <a href="https://api.whatsapp.com/send?text={{ heading_title }} {{ share }}" target="_blank" rel="noopener" class="product-share-icon" title="WhatsApp">
        <i class="material-icons">phone</i>
      </a>
      <button type="button" class="product-share-icon" id="btn-copy-link" title="Copy Link" data-url="{{ share }}">
        <i class="material-icons">link</i>
      </button>
    </div>
    <div class="product-share-right">
      <button type="button" class="product-action-btn" onclick="wishlist.add('{{ product_id }}');">
        <i class="material-icons">bookmark_border</i> Save
      </button>
      <button type="button" class="product-action-btn" onclick="compare.add('{{ product_id }}');">
        <i class="material-icons">add_box</i> Add to Compare
      </button>
    </div>
  </div>

  <div class="row">{{ column_left }}
    {% if column_left and column_right %}
    {% set class = 'col-sm-6' %}
    {% elseif column_left or column_right %}
    {% set class = 'col-sm-9' %}
    {% else %}
    {% set class = 'col-sm-12' %}
    {% endif %}
    <div id="content" class="{{ class }}">{{ content_top }}

      {# ── Product Detail Grid: images left, info right ── #}
      <div class="product-detail-grid">

        {# ── Left: Image Gallery ── #}
        <div class="product-images-col">
          {% if thumb or images %}
          <div class="product-main-image" id="product-main-image">
            <a href="{{ popup }}" class="product-main-image-link" id="main-image-link" title="{{ heading_title }}">
              <img src="{{ popup }}" id="main-image" title="{{ heading_title }}" alt="{{ heading_title }}" />
            </a>
          </div>
          <ul class="product-thumbnails" id="product-thumbnails">
            {% if thumb %}
            <li class="product-thumb-item active">
              <a class="product-thumb-link" href="{{ popup }}" data-thumb="{{ thumb }}" title="{{ heading_title }}">
                <img src="{{ thumb }}" title="{{ heading_title }}" alt="{{ heading_title }}" />
              </a>
            </li>
            {% endif %}
            {% for image in images %}
            <li class="product-thumb-item">
              <a class="product-thumb-link" href="{{ image.popup }}" data-thumb="{{ image.thumb }}" title="{{ heading_title }}">
                <img src="{{ image.thumb }}" title="{{ heading_title }}" alt="{{ heading_title }}" />
              </a>
            </li>
            {% endfor %}
          </ul>
          {% endif %}
        </div>

        {# ── Right: Product Info ── #}
        <div class="product-info-col">
          <h1 class="product-title">{{ heading_title }}</h1>

          {# Info Pills #}
          <div class="product-info-pills">
            {% if price %}
            <div class="info-pill">
              <span class="info-pill__label">Price:</span>
              {% if special %}
              <span class="info-pill__value info-pill__value--price">{{ special }}</span>
              <span class="info-pill__value info-pill__value--old">{{ price }}</span>
              {% else %}
              <span class="info-pill__value info-pill__value--price">{{ price }}</span>
              {% endif %}
            </div>
            {% endif %}
            {% if price and not special %}
            <div class="info-pill">
              <span class="info-pill__label">Regular Price:</span>
              <span class="info-pill__value">{{ price }}</span>
            </div>
            {% elseif price and special %}
            <div class="info-pill">
              <span class="info-pill__label">Regular Price:</span>
              <span class="info-pill__value">{{ price }}</span>
            </div>
            {% endif %}
            <div class="info-pill">
              <span class="info-pill__label">Status:</span>
              <span class="info-pill__value">{{ stock }}</span>
            </div>
            {% if manufacturer %}
          <div class="info-pill">
            <span class="info-pill__label">Brand:</span>
            <a href="{{ manufacturers }}" class="info-pill__value">{{ manufacturer }}</a>
          </div>
          {% endif %}
          </div>

          

          {# Key Features #}
          <div class="product-key-features">
            <h3>Key Features</h3>
            <ul class="key-features-list">
              <li>Model: {{ model }}</li>
            </ul>
            <a href="#tab-description" class="view-more-link" id="view-more-link">View More Info</a>
          </div>

          

          <div id="product">
            {# Product Options #}
            {% if options %}
            <div class="product-options-section">
              {% for option in options %}

              {% if option.type == 'select' %}
              <div class="form-group{% if option.required %} required{% endif %}">
                <label class="control-label">{{ option.name }}:</label>
                <input type="hidden" name="option[{{ option.product_option_id }}]" id="input-option{{ option.product_option_id }}" value="" />
                <div class="option-pills" data-option-id="{{ option.product_option_id }}" data-type="select">
                  {% for v in option.product_option_value %}
                  <button type="button" class="option-pill" data-value="{{ v.product_option_value_id }}" data-price-raw="{{ v.price_raw }}" data-price-prefix="{{ v.price_prefix }}">
                    {{ v.name }}{% if v.price %} ({{ v.price_prefix }}{{ v.price }}){% endif %}
                  </button>
                  {% endfor %}
                </div>
              </div>
              {% endif %}

              {% if option.type == 'radio' %}
              <div class="form-group{% if option.required %} required{% endif %}">
                <label class="control-label">{{ option.name }}:</label>
                <input type="hidden" name="option[{{ option.product_option_id }}]" id="input-option{{ option.product_option_id }}" value="" />
                <div class="option-pills" data-option-id="{{ option.product_option_id }}" data-type="radio">
                  {% for v in option.product_option_value %}
                  <button type="button" class="option-pill" data-value="{{ v.product_option_value_id }}" data-price-raw="{{ v.price_raw }}" data-price-prefix="{{ v.price_prefix }}">
                    {% if v.image %}<img src="{{ v.image }}" alt="{{ v.name }}" class="option-pill__img" />{% endif %}
                    {{ v.name }}{% if v.price %} ({{ v.price_prefix }}{{ v.price }}){% endif %}
                  </button>
                  {% endfor %}
                </div>
              </div>
              {% endif %}

              {% if option.type == 'checkbox' %}
              <div class="form-group{% if option.required %} required{% endif %}">
                <label class="control-label">{{ option.name }}:</label>
                <div class="option-pills" data-option-id="{{ option.product_option_id }}" data-type="checkbox">
                  {% for v in option.product_option_value %}
                  <button type="button" class="option-pill" data-value="{{ v.product_option_value_id }}" data-price-raw="{{ v.price_raw }}" data-price-prefix="{{ v.price_prefix }}">
                    {% if v.image %}<img src="{{ v.image }}" alt="{{ v.name }}" class="option-pill__img" />{% endif %}
                    {{ v.name }}{% if v.price %} ({{ v.price_prefix }}{{ v.price }}){% endif %}
                  </button>
                  {% endfor %}
                </div>
                {# Hidden inputs appended dynamically by JS for checked pills #}
              </div>
              {% endif %}

              {% if option.type == 'text' %}
              <div class="form-group{% if option.required %} required{% endif %}">
                <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
                <input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" placeholder="{{ option.name }}" id="input-option{{ option.product_option_id }}" class="form-control" />
              </div>
              {% endif %}

              {% if option.type == 'textarea' %}
              <div class="form-group{% if option.required %} required{% endif %}">
                <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
                <textarea name="option[{{ option.product_option_id }}]" rows="5" placeholder="{{ option.name }}" id="input-option{{ option.product_option_id }}" class="form-control">{{ option.value }}</textarea>
              </div>
              {% endif %}

              {% if option.type == 'file' %}
              <div class="form-group{% if option.required %} required{% endif %}">
                <label class="control-label">{{ option.name }}</label>
                <button type="button" id="button-upload{{ option.product_option_id }}" class="btn btn-upload">
                  <i class="material-icons">upload</i> {{ button_upload }}
                </button>
                <input type="hidden" name="option[{{ option.product_option_id }}]" value="" id="input-option{{ option.product_option_id }}" />
              </div>
              {% endif %}

              {% if option.type == 'date' %}
              <div class="form-group{% if option.required %} required{% endif %}">
                <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
                <input type="date" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" id="input-option{{ option.product_option_id }}" class="form-control" />
              </div>
              {% endif %}

              {% if option.type == 'datetime' %}
              <div class="form-group{% if option.required %} required{% endif %}">
                <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
                <input type="datetime-local" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" id="input-option{{ option.product_option_id }}" class="form-control" />
              </div>
              {% endif %}

              {% if option.type == 'time' %}
              <div class="form-group{% if option.required %} required{% endif %}">
                <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
                <input type="time" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" id="input-option{{ option.product_option_id }}" class="form-control" />
              </div>
              {% endif %}

              {% endfor %}
            </div>
            {% endif %}

            {% if recurrings %}
            <div class="product-recurring-section">
              <h3>{{ text_payment_recurring }}</h3>
              <div class="form-group required">
                <select name="recurring_id" class="form-control">
                  <option value="">{{ text_select }}</option>
                  {% for recurring in recurrings %}
                  <option value="{{ recurring.recurring_id }}">{{ recurring.name }}</option>
                  {% endfor %}
                </select>
                <div class="help-block" id="recurring-description"></div>
              </div>
            </div>
            {% endif %}

            {# Payment Options #}
            {% if price %}
            <div class="payment-options">
              <h3>Payment Options</h3>
              <div class="payment-options-grid">
                <label class="payment-card payment-card--active" id="payment-cash">
                  <input type="radio" name="payment_option" value="cash" checked hidden />
                  <div class="payment-card__price">
                    {% if special %}
                    <span class="payment-card__amount">{{ special }}</span>
                    <span class="payment-card__old">{{ price }}</span>
                    {% else %}
                    <span class="payment-card__amount">{{ price }}</span>
                    {% endif %}
                  </div>
                  <div class="payment-card__label">Cash Discount Price</div>
                  <div class="payment-card__sub">Online / Cash Payment</div>
                </label>
                
                <label class="payment-card" id="payment-emi">
                  <input type="radio" name="payment_option" value="emi" hidden />
                  <div class="payment-card__price">
                    <span class="payment-card__amount payment-card__amount--emi" id="emi-monthly-amount"></span>
                  </div>
                  <div class="payment-card__label">Regular Price: {{ price }}</div>
                  <div class="payment-card__sub">0% EMI for up to 12 Months***</div>
                </label>
                <script>
                  (function(){
                    var raw = {{ price_raw }};
                    var monthly = Math.ceil(raw / 12);
                    var el = document.getElementById('emi-monthly-amount');
                    if (el) el.textContent = '{{ currency_left }}' + monthly.toLocaleString() + '{{ currency_right }}/month';
                  })();
                </script>
                
              </div>
            </div>
            {% endif %}

            {# Quantity + Buy Now #}
            <div class="product-buy-row">
              <div class="product-qty-control">
                <button type="button" class="qty-btn" id="qty-minus"><i class="material-icons">remove</i></button>
                <input type="number" name="quantity" value="{{ minimum }}" min="1" id="input-quantity" class="qty-input" />
                <button type="button" class="qty-btn" id="qty-plus"><i class="material-icons">add</i></button>
              </div>
              <input type="hidden" name="product_id" value="{{ product_id }}" />
              <button type="button" id="button-cart" class="btn-buy-now">Buy Now</button>
            </div>

            {% if minimum > 1 %}
            <div class="alert alert-info">
              <i class="material-icons">info</i> {{ text_minimum }}
            </div>
            {% endif %}

            {# {% if tax %}<div class="product-tax">{{ text_tax }} {{ tax }}</div>{% endif %}
            {% if points %}<div class="product-points">{{ text_points }} {{ points }}</div>{% endif %} #}
            {% if discounts %}
            <ul class="product-discounts">
              {% for discount in discounts %}
              <li>{{ discount.quantity }}{{ text_discount }}{{ discount.price }}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>
        </div>
      </div>{# /.product-detail-grid #}

      {# ── Section Nav + Content ── #}
      <div class="product-lower-grid">
        <div class="product-tabs-wrapper">
          {# Sticky anchor nav #}
          <div class="product-tabs">
            <ul class="product-tab-nav" role="tablist">
              {% if attribute_groups %}
              <li class="product-tab-item active">
                <a href="#tab-specification" class="product-tab-link" role="tab">Specification</a>
              </li>
              {% endif %}
              <li class="product-tab-item{% if not attribute_groups %} active{% endif %}">
                <a href="#tab-description" class="product-tab-link" role="tab">{{ tab_description }}</a>
              </li>
              {% if review_status %}
              <li class="product-tab-item">
                <a href="#tab-review" class="product-tab-link" role="tab">{{ tab_review }}</a>
              </li>
              {% endif %}
            </ul>
          </div>

          {# All sections visible, stacked vertically #}
          {% if attribute_groups %}
          <div class="product-section" id="tab-specification">
            <h2 class="product-section__title">Specification</h2>
            <table class="spec-table">
              {% for attribute_group in attribute_groups %}
              <thead>
                <tr><td colspan="2"><strong>{{ attribute_group.name }}</strong></td></tr>
              </thead>
              <tbody>
              {% for attribute in attribute_group.attribute %}
              <tr>
                <td>{{ attribute.name }}</td>
                <td>{{ attribute.text }}</td>
              </tr>
              {% endfor %}
              </tbody>
              {% endfor %}
            </table>
          </div>
          {% endif %}

          <div class="product-section" id="tab-description">
            <h2 class="product-section__title">{{ tab_description }}</h2>
            <div class="product-section__body">{{ description }}</div>
          </div>

          {% if review_status %}
          <div class="product-section" id="tab-review">
            <div class="review-tab-header">
              <div>
                <h2 class="product-section__title" style="margin-bottom:4px;">{{ tab_review }}</h2>
                <p class="review-tab-subtitle">Get specific details about this product from customers who own it.</p>
              </div>
              {% if review_guest %}
              <button type="button" class="btn-write-review" id="btn-toggle-review-form">Write a Review</button>
              {% endif %}
            </div>
            <div id="review"></div>
            <form id="form-review" class="review-form" style="display:none;">
              {% if review_guest %}
              <h3>{{ text_write }}</h3>
              <div class="form-group required">
                <label class="control-label" for="input-name">{{ entry_name }}</label>
                <input type="text" name="name" value="{{ customer_name }}" id="input-name" class="form-control" />
              </div>
              <div class="form-group required">
                <label class="control-label" for="input-review">{{ entry_review }}</label>
                <textarea name="text" rows="5" id="input-review" class="form-control"></textarea>
                <div class="help-block">{{ text_note }}</div>
              </div>
              <div class="form-group required">
                <label class="control-label">{{ entry_rating }}</label>
                <div class="rating-input">
                  {% for i in 1..5 %}
                  <label class="rating-star" title="{{ i }} star{{ i > 1 ? 's' : '' }}">
                    <input type="radio" name="rating" value="{{ i }}" hidden />
                    <i class="material-icons">star_border</i>
                  </label>
                  {% endfor %}
                </div>
              </div>
              {{ captcha }}
              <div class="review-form-actions">
                <button type="button" id="button-review" class="btn-submit-review">{{ button_continue }}</button>
              </div>
              {% else %}
              {{ text_login }}
              {% endif %}
            </form>
          </div>
          {% endif %}
        </div>

        {# Right: Sidebar #}
        <div class="product-sidebar">
          {% if products %}
          <div class="sidebar-card">
            <h3 class="sidebar-card__title">Related Product</h3>
            <div class="related-products-list">
              {% for product in products %}
              <div class="related-product-item">
                <a href="{{ product.href }}" class="related-product-item__img">
                  <img src="{{ product.thumb }}" alt="{{ product.name }}" title="{{ product.name }}" />
                </a>
                <div class="related-product-item__info">
                  <a href="{{ product.href }}" class="related-product-item__name">{{ product.name }}</a>
                  {% if product.price %}
                  <div class="related-product-item__price">
                    {% if product.special %}
                    <span class="price-new">{{ product.special }}</span>
                    <span class="price-old">{{ product.price }}</span>
                    {% else %}
                    <span class="price-current">{{ product.price }}</span>
                    {% endif %}
                  </div>
                  {% endif %}
                  <button type="button" class="related-product-item__compare" onclick="compare.add('{{ product.product_id }}');">
                    <i class="material-icons">add_box</i> Add to Compare
                  </button>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          {% if tags %}
          <div class="sidebar-card">
            <h3 class="sidebar-card__title">Tags</h3>
            <div class="product-tags">
              {% for i in 0..tags|length - 1 %}
              <a href="{{ tags[i].href }}" class="product-tag-pill">{{ tags[i].tag }}</a>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>

      {{ content_bottom }}
    </div>
    {{ column_right }}
  </div>
</div>

{# Pass product_id and review_status to product.js via data attributes #}
<div id="product-data"
     data-product-id="{{ product_id }}"
     data-review-status="{{ review_status ? '1' : '0' }}"
     data-price-raw="{{ price_raw }}"
     data-special-raw="{{ special_raw }}"
     data-currency-left="{{ currency_left }}"
     data-currency-right="{{ currency_right }}"
     data-product-title="{{ heading_title }}"
     style="display:none;"></div>

{{ footer }}
